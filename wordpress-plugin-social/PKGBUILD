_developer=http://mailchimp.com/
_maintainer=http://indieboxproject.org/
pkgname=$(basename $(pwd))
_plugin=${pkgname/wordpress-plugin-/}
pkgver=2.11
pkgrel=1
pkgdesc="Broadcast posts to Twitter or Facebook"
arch=('any')
url=$_developer
_license=GPL
license=("$_license")
groups=()
depends=('wordpress')
backup=()
source=("http://downloads.wordpress.org/plugin/${_plugin}.${pkgver}.zip")
options=('!strip')
md5sums=('SKIP')
# from http://stackoverflow.com/questions/1251999/sed-how-can-i-replace-a-newline-n
_parameterize=$(cat <<END
    s!##pkgname##!$pkgname!g;
    s/##pkgdesc##/$pkgdesc/g;
    s!##developer##!$_developer!g;
    s!##maintainer##!$_maintainer!g;
    s!##pkgver##!$pkgver!g;
    s!##pkgrel##!$pkgrel!g;
    s!##accessoryid##!$_plugin!g;
    s!##license##!$_license!g;
    s!##description##!$_description!g;
END
)

package() {
# Manifest
    mkdir -p $pkgdir/var/lib/indie-box/manifests
    perl -pe "$_parameterize" $startdir/indie-box-manifest.json > $pkgdir/var/lib/indie-box/manifests/${pkgname}.json
    chmod 0644 $pkgdir/var/lib/indie-box/manifests/${pkgname}.json

# Icons
    # mkdir -p $pkgdir/srv/http/_appicons/$pkgname
    # install -m644 $startdir/appicons/{72x72,144x144}.png $pkgdir/srv/http/_appicons/$pkgname/

# Source
    mkdir -p $pkgdir/usr/share/${pkgname}

    cp -a $startdir/src/${_plugin} $pkgdir/usr/share/${pkgname}/
}
